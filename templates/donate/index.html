<!DOCTYPE html>
<html lang="ru">

<head>
    <title>Поддержать проект</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {% include 'partials/base_header.html' %}
    <link rel="stylesheet" href="{{ 'donate.css' | ver }}" />
</head>

<body>
    <div class="page-background" style="background-image: url('/static/images/wallpaper.jpeg');">
        {% include 'partials/header.html' %}

        <main class="donate-wrap">
            <section class="donate content-tile">
                <h1>Поддержать проект</h1>

                {% if error %}
                <div class="form-error">{{ error }}</div>
                {% endif %}

                <form method="post" action="/donate/submit" id="donate-form" novalidate>
                    <div class="form-field">
                        <label class="form-label" for="amount">Сумма, ₽</label>
                        <input id="amount" name="amount" class="form-input" type="number" step="0.01"
                            min="{{ min_amount }}" max="{{ max_amount }}" inputmode="decimal"
                            placeholder="Например, 200.00" value="{{ amount or '' }}" required />
                        <p class="muted">Допустимый диапазон: от {{ min_amount }} до {{ max_amount }} ₽.</p>
                    </div>

                    <div class="form-field">
                        <span class="form-label">Способ оплаты</span>
                        <div class="radio-group">
                            <label class="radio-pill">
                                <input type="radio" name="method" value="AC" {% if method=='AC' or not method
                                    %}checked{% endif %} />
                                Картой
                            </label>
                            <label class="radio-pill">
                                <input type="radio" name="method" value="PC" {% if method=='PC' %}checked{% endif %} />
                                ЮMoney
                            </label>
                        </div>
                    </div>

                    <div class="form-field checkbox-line">
                        <label class="checkbox-label">
                            <input type="checkbox" name="cover_commission" {% if cover_commission %}checked{% endif
                                %} />
                            <span class="custom-checkbox"></span>
                            Покрыть комиссию
                        </label>
                        <span class="muted">Пересчёт суммы произойдёт на сервере.</span>
                    </div>

                    <p class="donate-warning" role="alert">
                        Это добровольное пожертвование, а не покупка.<br><br>
                        Если хотите что-то приобрести, свяжитесь с администрацией через тикеты в Discord.<br><br>
                        Пожертвования не возвращаются.<br><br>
                        Оплата предметов/услуг через этот раздел не засчитывается.
                    </p>

                    <div class="form-field checkbox-line">
                        <label class="checkbox-label">
                            <input type="checkbox" id="agree_terms" name="agree_terms" />
                            <span class="custom-checkbox"></span>
                            Я понимаю, что это добровольное пожертвование и оно не подлежит возврату
                        </label>
                    </div>

                    <div class="form-field">
                        <button class="btn-primary" id="submit-btn" type="submit" disabled aria-disabled="true">
                            Перейти к оплате
                        </button>
                    </div>

                    <p class="muted">Оплата проходит на стороне YooMoney. Мы не храним данные вашей карты.</p>
                </form>
            </section>
        </main>
    </div>

    <script>
        const form = document.getElementById('donate-form');
        const amount = document.getElementById('amount');
        const agree = document.getElementById('agree_terms');
        const submitBtn = document.getElementById('submit-btn');

        amount.addEventListener('wheel', (e) => e.preventDefault(), { passive: false });
        amount.addEventListener('keydown', (e) => {
            if (['ArrowUp', 'ArrowDown'].includes(e.key)) e.preventDefault();
        });

        function updateSubmitState() {
            const ok = !!agree.checked;
            submitBtn.disabled = !ok;
            submitBtn.setAttribute('aria-disabled', String(!ok));
        }
        agree.addEventListener('change', updateSubmitState);
        updateSubmitState();

        form.addEventListener('submit', (e) => {
            if (!agree.checked) { e.preventDefault(); return; }

            let val = (amount.value || '').replace(',', '.').trim();
            if (!val) { e.preventDefault(); return; }

            if (val.startsWith('.')) val = '0' + val;
            const num = Number(val);
            if (!isFinite(num) || num <= 0) { e.preventDefault(); return; }

            amount.value = num.toFixed(2);
        });
    </script>
</body>

</html>